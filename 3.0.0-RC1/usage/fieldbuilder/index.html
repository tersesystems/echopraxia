
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Echopraxia - Structured logging for Java">
      
      
        <meta name="author" content="Will Sargent">
      
      
        <link rel="canonical" href="https://tersesystems.github.io/echopraxia/3.0.0-RC1/usage/fieldbuilder/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>Field Builders - Echopraxia</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#field-builders" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Echopraxia" class="md-header__button md-logo" aria-label="Echopraxia" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Echopraxia
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Field Builders
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tersesystems/echopraxia" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    echopraxia
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Echopraxia" class="md-nav__button md-logo" aria-label="Echopraxia" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Echopraxia
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tersesystems/echopraxia" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    echopraxia
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Field Builders
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Field Builders
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fields-and-values" class="md-nav__link">
    Fields and Values
  </a>
  
    <nav class="md-nav" aria-label="Fields and Values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#values" class="md-nav__link">
    Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    Fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-presentation" class="md-nav__link">
    Field Presentation
  </a>
  
    <nav class="md-nav" aria-label="Field Presentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asvalueonly" class="md-nav__link">
    asValueOnly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ascardinal" class="md-nav__link">
    asCardinal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withdisplayname" class="md-nav__link">
    withDisplayName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abbreviateafter" class="md-nav__link">
    abbreviateAfter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aselided" class="md-nav__link">
    asElided
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-field-builders" class="md-nav__link">
    Defining Field Builders
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-names" class="md-nav__link">
    Field Names
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-null-values" class="md-nav__link">
    Managing Null Values
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-objects" class="md-nav__link">
    Complex Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packages-and-modules" class="md-nav__link">
    Packages and Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exception-handling" class="md-nav__link">
    Exception Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structuredformat" class="md-nav__link">
    StructuredFormat
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../context/" class="md-nav__link">
        Context
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../conditions/" class="md-nav__link">
        Conditions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logger/" class="md-nav__link">
        Custom Logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../filters/" class="md-nav__link">
        Filters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scripting/" class="md-nav__link">
        Scripting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Frameworks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Frameworks" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Frameworks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../frameworks/logback/" class="md-nav__link">
        Logback Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../frameworks/log4j2/" class="md-nav__link">
        Log4J2 Framework
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Additional Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Additional Features" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Additional Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional/diff/" class="md-nav__link">
        Diff Field Builder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional/fluent/" class="md-nav__link">
        Fluent Logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../additional/semantic/" class="md-nav__link">
        Semantic Logger
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fields-and-values" class="md-nav__link">
    Fields and Values
  </a>
  
    <nav class="md-nav" aria-label="Fields and Values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#values" class="md-nav__link">
    Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    Fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-presentation" class="md-nav__link">
    Field Presentation
  </a>
  
    <nav class="md-nav" aria-label="Field Presentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asvalueonly" class="md-nav__link">
    asValueOnly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ascardinal" class="md-nav__link">
    asCardinal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withdisplayname" class="md-nav__link">
    withDisplayName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abbreviateafter" class="md-nav__link">
    abbreviateAfter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aselided" class="md-nav__link">
    asElided
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-field-builders" class="md-nav__link">
    Defining Field Builders
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-names" class="md-nav__link">
    Field Names
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-null-values" class="md-nav__link">
    Managing Null Values
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-objects" class="md-nav__link">
    Complex Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packages-and-modules" class="md-nav__link">
    Packages and Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exception-handling" class="md-nav__link">
    Exception Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structuredformat" class="md-nav__link">
    StructuredFormat
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/tersesystems/echopraxia/edit/main/docs/usage/fieldbuilder.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="field-builders">Field Builders<a class="headerlink" href="#field-builders" title="Permanent link">&para;</a></h1>
<p>To do most useful things in Echopraxia, you'll want to define field builders.  This page explains the overall API of fields and values, what a field builder does, and how to use it.</p>
<h2 id="fields-and-values">Fields and Values<a class="headerlink" href="#fields-and-values" title="Permanent link">&para;</a></h2>
<p>Structured logging in Echopraxia is defined using <code>com.tersesystems.echopraxia.api.Field</code> and <code>com.tersesystems.echopraxia.api.Value</code>.  A <code>Field</code> consists of a <code>name()</code> that is a <code>String</code>, and a <code>value()</code> of type <code>Value&lt;?&gt;</code>.</p>
<h3 id="values">Values<a class="headerlink" href="#values" title="Permanent link">&para;</a></h3>
<p>A <code>Value</code> corresponds mostly to the JSON infoset. It can be a <em>primitive</em>: a string, a number, a boolean, a null, or <code>java.lang.Throwable</code>.  Or, it can be <em>complex</em>: an array that contains a list of values, or an object which contains a list of fields.</p>
<p>To create a primitive value, you call a static factory method:</p>
<ul>
<li><code>Value.string("string value")</code> creates a <code>Value&lt;String&gt;</code></li>
<li><code>Value.nullValue()</code> create a <code>Value&lt;Void&gt;</code></li>
<li><code>Value.number(intValue)</code> create a <code>Value&lt;Number&gt;</code></li>
<li><code>Value.bool(true)</code> creates a <code>Value&lt;Boolean&gt;</code></li>
<li><code>Value.exception(throwable)</code> creates a <code>Value&lt;Throwable&gt;</code></li>
</ul>
<p>For complex objects, there are some utility methods:</p>
<ul>
<li><code>Value.array(valueList)</code> takes <code>Value</code> or the known primitives </li>
<li><code>Value.array(function, valueList)</code> will map the elements of <code>valueList</code> into <code>Value</code> using <code>function</code>.</li>
<li><code>Value.object(fields)</code> takes a list of fields</li>
<li><code>Value.object(function, objectList)</code> will map the elements of <code>objectList</code> into <code>Field</code> using <code>function</code>.</li>
</ul>
<p>In addition, there is <code>Value.optional</code> which takes <code>Optional&lt;Value&lt;V&gt;&gt;</code> and returns <code>Value&lt;?&gt;</code> where <code>nullValue</code> is used if <code>Optional.empty()</code> is found. </p>
<h3 id="fields">Fields<a class="headerlink" href="#fields" title="Permanent link">&para;</a></h3>
<p>The <code>Field</code> interface has some static methods that are the primary way to create fields:</p>
<ul>
<li><code>Field.keyValue(name, value)</code> returns a <code>Field</code> with the given name and value set, displaying as "name=value" in text.</li>
<li><code>Field.keyValue(name, value, PresentationField.class)</code> returns a <code>PresentationField</code> that has more methods on it.</li>
</ul>
<p>You can also define and extend <code>Field</code> with your own implementation, although that is outside the scope of this section.</p>
<p>You can also create a field using <code>Field.value(name, value)</code> or <code>Field.value(name, value, PresentationField.class)</code>, which creates a <code>Field</code> with the presentation attribute <code>asValueOnly</code> set.</p>
<h2 id="field-presentation">Field Presentation<a class="headerlink" href="#field-presentation" title="Permanent link">&para;</a></h2>
<p>There are times when the default field presentation is awkward, and you'd like to cut down on the amount of information displayed in the message.  You can do this by adding presentation hints to the field.</p>
<p>The <code>PresentationField</code> interface implements the <code>Field</code> interface and also provides some extra methods for customizing the presentation of the fields in a line oriented text format.  These presentation hints are provided by field attributes and are used by the <code>toString</code> formatter.</p>
<p>For the examples, we'll assume that <code>PresentationFieldBuilder</code> is being used here and therefore <code>keyValue</code> returns <code>PresentationField</code>.</p>
<h3 id="asvalueonly">asValueOnly<a class="headerlink" href="#asvalueonly" title="Permanent link">&para;</a></h3>
<p>The <code>asValueOnly</code> method has the effect of turning a "key=value" field into a "value" field in text format, just like the value method:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// same as Field valueField = value(name, value);</span><span class="w"></span>
<span class="n">Field</span><span class="w"> </span><span class="n">valueField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;onlyValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="s">&quot;someText&quot;</span><span class="p">)).</span><span class="na">asValueOnly</span><span class="p">();</span><span class="w"></span>
<span class="n">valueField</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="c1">// renders someText</span><span class="w"></span>
</code></pre></div>
<h3 id="ascardinal">asCardinal<a class="headerlink" href="#ascardinal" title="Permanent link">&para;</a></h3>
<p>The <code>asCardinal</code> method, when used on a field with an array value or on a string, displays the number of elements in the array bracketed by "|" characters in text format:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">cardinalField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;elements&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">).</span><span class="na">asCardinal</span><span class="p">();</span><span class="w"></span>
<span class="n">cardinalField</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w"> </span><span class="c1">// renders elements=|3|</span><span class="w"></span>
</code></pre></div>
<h3 id="withdisplayname">withDisplayName<a class="headerlink" href="#withdisplayname" title="Permanent link">&para;</a></h3>
<p>The <code>withDisplayName</code> method shows a human readable string in text format bracketed in quotes:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">readableField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;json_field&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">number</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="na">withDisplayName</span><span class="p">(</span><span class="s">&quot;human readable name&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">readableField</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="c1">// renders &quot;human readable name&quot;=1</span><span class="w"></span>
</code></pre></div>
<h3 id="abbreviateafter">abbreviateAfter<a class="headerlink" href="#abbreviateafter" title="Permanent link">&para;</a></h3>
<p>The <code>abbreviateAfter</code> method will truncate an array or string that is very long and replace the rest with ellipsis:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">abbrField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;abbreviatedField&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="n">veryLongString</span><span class="p">)).</span><span class="na">abbreviateAfter</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="n">abbrField</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="c1">// renders abbreviatedField=12345...</span><span class="w"></span>
</code></pre></div>
<h3 id="aselided">asElided<a class="headerlink" href="#aselided" title="Permanent link">&para;</a></h3>
<p>The <code>asElided</code> method will elide the field so that it is passed over and does not show in text format:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">abbrField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;abbreviatedField&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="n">veryLongString</span><span class="p">)).</span><span class="na">asElided</span><span class="p">();</span><span class="w"></span>
<span class="n">abbrField</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="c1">// renders &quot;&quot;</span><span class="w"></span>
</code></pre></div>
<p>This is particularly useful in objects that have elided children that you don't need to see in the message:</p>
<div class="highlight"><pre><span></span><code><span class="n">Field</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;first&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">)).</span><span class="na">asElided</span><span class="p">();</span><span class="w"></span>
<span class="n">Field</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;second&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">));</span><span class="w"></span>
<span class="n">Field</span><span class="w"> </span><span class="n">third</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;third&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">)).</span><span class="na">asElided</span><span class="p">();</span><span class="w"></span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Field</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">second</span><span class="p">,</span><span class="w"> </span><span class="n">third</span><span class="p">);</span><span class="w"></span>
<span class="n">Field</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;object&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">object</span><span class="p">(</span><span class="n">fields</span><span class="p">));</span><span class="w"></span>
<span class="n">assertThat</span><span class="p">(</span><span class="n">object</span><span class="p">.</span><span class="na">toString</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;object={second=bar}&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<h2 id="defining-field-builders">Defining Field Builders<a class="headerlink" href="#defining-field-builders" title="Permanent link">&para;</a></h2>
<p>The <code>FieldBuilder</code> interface provides some convenience methods around <code>Field</code> and <code>Value</code>.  </p>
<ul>
<li><code>keyValue</code>: renders a field with <code>name=value</code> when rendered in logfmt line oriented text.</li>
<li><code>value</code>: renders a field with <code>value</code> when rendered in logfmt line oriented text.</li>
</ul>
<p><code>FieldBuilder</code> comes with some additional methods for common types, i.e.</p>
<ul>
<li><code>fb.string</code>: creates a field with a string as a value, same as <code>fb.keyValue(name, Value.string(str))</code>.</li>
<li><code>fb.number</code>: creates a field with a number as a value, same as <code>fb.keyValue(name, Value.number(num))</code>.</li>
<li><code>fb.bool</code>: creates a field with a boolean as a value, same as <code>fb.keyValue(name, Value.bool(b))</code>.</li>
<li><code>fb.nullValue</code>: creates a field with a null as a value, same as <code>fb.keyValue(name, Value.nullValue())</code></li>
<li><code>fb.array</code>: creates a field with an array as a value, same as <code>fb.keyValue(name, Value.array(arr))</code></li>
<li><code>fb.obj</code>: creates a field with an object as a value, same as <code>fb.keyValue(name, Value.``object``(o))</code></li>
<li><code>fb.exception</code>: creates a field with a throwable as a value, same as <code>fb.keyValue(name, Value.exception(t))</code>.</li>
</ul>
<p>The <code>PresentationFieldBuilder</code> interface is the same as <code>FieldBuilder</code> but returns <code>PresentationField</code> by default.</p>
<p>To create a field builder, you start with an interface (typically using <code>FieldBuilder</code> or <code>PresentationFieldBuilder</code> as a base) and then pass that field builder into your <code>Logger</code> using <code>withFieldBuilder</code>.  Although convenient, you are not required to extend <code>FieldBuilder</code> or <code>PresentationFieldBuilder</code>, and can use <code>Field</code> and <code>Value</code> methods directly to create your own builders (useful if you don't want to expose field names directly).</p>
<p>You can then create custom methods on your field builder that will render your class.  In this case, we'll create a field builder that can handle a <code>java.util.Date</code>, and create <code>date</code> and <code>dateValue</code> methods for it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">com.tersesystems.echopraxia.api.*</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span><span class="w"></span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BuilderWithDate</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">PresentationFieldBuilder</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="n">BuilderWithDate</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BuilderWithDate</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">PresentationField</span><span class="w"> </span><span class="nf">date</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dateValue</span><span class="p">(</span><span class="n">date</span><span class="p">));</span><span class="w"> </span><span class="c1">// use a default name</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">PresentationField</span><span class="w"> </span><span class="nf">date</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">dateValue</span><span class="p">(</span><span class="n">date</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Renders a date as an ISO 8601 string.</span><span class="w"></span>
<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">StringValue</span><span class="w"> </span><span class="nf">dateValue</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ISO_INSTANT</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">toInstant</span><span class="p">()));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>And then create a <code>Logger&lt;BuilderWithDate&gt;</code>:</p>
<div class="highlight"><pre><span></span><code>Logger&lt;BuilderWithDate&gt; dateLogger = basicLogger.withFieldBuilder(BuilderWithDate.instance);
</code></pre></div>
<p>And now you can render a date automatically:</p>
<div class="highlight"><pre><span></span><code><span class="n">dateLogger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Date {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">date</span><span class="p">(</span><span class="s">&quot;creation_date&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">()));</span><span class="w"></span>
</code></pre></div>
<h2 id="field-names">Field Names<a class="headerlink" href="#field-names" title="Permanent link">&para;</a></h2>
<p>Allowing the end user to define field names directly can be nice, but also introduces additional complexity.</p>
<p>The advantage to using a field name is that it allows a user to distinguish ad-hoc inputs.  For example, if you have a start date and an end date:</p>
<div class="highlight"><pre><span></span><code>logger.info(&quot;{} to {}&quot;, fb.list(
  fb.date(&quot;start_date&quot;, startDate),
  fb.date(&quot;end_date&quot;, endDate)
));
</code></pre></div>
<p>This is more convenient than explicitly setting up the field builder with two extra methods and then having to call them:</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span> <span class="nc">BuilderWithDate</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">startDate</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">date</span><span class="p">(</span><span class="s">&quot;start_date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">endDate</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">date</span><span class="p">(</span><span class="s">&quot;end_date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;{} to {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">list</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">fb</span><span class="p">.</span><span class="na">startDate</span><span class="p">(</span><span class="n">startDate</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="n">fb</span><span class="p">.</span><span class="na">endDate</span><span class="p">(</span><span class="n">endDate</span><span class="p">)</span><span class="w"></span>
<span class="p">));</span><span class="w"></span>
</code></pre></div>
<p>However, there are downsides to defining names directly in statements, especially when using centralized logging.</p>
<p>The first issue is that you may have to sanitize or validate the input name depending on your centralized logging.  For example, ElasticSearch does not support <a href="https://www.elastic.co/blog/introducing-the-de_dot-filter">field names containing a . (dot) character</a>, so if you do not convert or reject invalid field names.  </p>
<p>A broader issue is that field names are not scoped by the logger name.  Centralized logging does not know that in the <code>FooLogger</code> a field name may be a string, but in the <code>BarLogger</code>, the same field name will be a number.  </p>
<p>This can cause issues in centralized logging -- ElasticSearch will attempt to define a schema based on dynamic mapping, meaning that if two log statements in the same index have the same field name but different types, i.e. <code>"error": 404</code> vs <code>"error": "not found"</code> then Elasticsearch will render <code>mapper_parsing_exception</code> and may reject log statements if you do not have <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/ignore-malformed.html">ignore_malformed</a> turned on.  </p>
<p>Even if you turn <code>ignore_malformed</code> on or have different mappings, a change in a mapping across indexes will be enough to stop ElasticSearch from querying correctly.  ElasticSearch will also flatten field names, which can cause more confusion as conflicts will only come when objects have both the same field name and property, i.e. they are both called <code>error</code> and are objects that work fine, but fail when an optional <code>code</code> property is added.</p>
<p>Likewise, field names are not automatically scoped by context.  You may have collision cases where two different fields have the same name in the same statement:</p>
<div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="p">.</span><span class="na">withFields</span><span class="p">(</span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">keyValue</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)).</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">keyValue</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">otherUserId</span><span class="p">));</span><span class="w"></span>
</code></pre></div>
<p>This will produce a statement that has two <code>user_id</code> fields with two different values -- which is technically valid JSON, but may not be what centralized logging expects.  You can qualify your arguments by adding a <a href="https://github.com/logfellow/logstash-logback-encoder#nested-json-provider">nested</a>, or add logic that will validate/reject/clean invalid fields, but it may be simpler to explicitly pass in distinct names or namespace with <code>fb.object</code> or <code>Value.object</code>.</p>
<h2 id="managing-null-values">Managing Null Values<a class="headerlink" href="#managing-null-values" title="Permanent link">&para;</a></h2>
<p>At some point you will have a value that you want to render and the Java API will return <code>null</code>.</p>
<p>I recommend using <a href="https://www.jetbrains.com/help/idea/annotating-source-code.html#jetbrains-annotations">Jetbrains annotations</a> which includes a <code>@NotNull</code> annotation.</p>
<p>You can defensively program against this by explicitly checking against nulls in the field builder, by explicitly checking against <code>null</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Duration</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.jetbrains.annotations.NotNull</span><span class="p">;</span><span class="w"></span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">NullableFieldBuilder</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">FieldBuilder</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">Value</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">durationValue</span><span class="p">(</span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">deadline</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="n">duration</span><span class="p">.</span><span class="na">toString</span><span class="p">())</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">nullValue</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Field names are never allowed to be null.  If a field name is null, it will be replaced at runtime with <code>unknown-echopraxia-N</code> where N is an incrementing number.</p>
<div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Message name {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="n">fb</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;some-value&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// null field names not allowed</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<h2 id="complex-objects">Complex Objects<a class="headerlink" href="#complex-objects" title="Permanent link">&para;</a></h2>
<p>The value of a field builder compounds as you build up complex objects from simple ones.</p>
<p>In the <a href="https://github.com/tersesystems/echopraxia-examples/blob/main/custom-field-builder/README.md">custom field builder example</a>, the <code>Person</code> class is rendered using a custom field builder:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PersonFieldBuilder</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">FieldBuilder</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Renders a `Person` as an object field.</span><span class="w"></span>
<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="nf">person</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fieldName</span><span class="p">,</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="n">fieldName</span><span class="p">,</span><span class="w"> </span><span class="n">personValue</span><span class="p">(</span><span class="n">p</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">Value</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">personValue</span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">nullValue</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Note that properties must be broken down to the basic JSON types,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// i.e. a primitive string/number/boolean/null or object/array.</span><span class="w"></span>
<span class="w">    </span><span class="n">Field</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">name</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">Field</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">age</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">Field</span><span class="w"> </span><span class="n">father</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;father&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">personValue</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="na">getFather</span><span class="p">()));</span><span class="w"></span>
<span class="w">    </span><span class="n">Field</span><span class="w"> </span><span class="n">mother</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;mother&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">personValue</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="na">getMother</span><span class="p">()));</span><span class="w"></span>
<span class="w">    </span><span class="n">Field</span><span class="w"> </span><span class="n">interests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">(</span><span class="s">&quot;interests&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">interests</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">object</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">father</span><span class="p">,</span><span class="w"> </span><span class="n">mother</span><span class="p">,</span><span class="w"> </span><span class="n">interests</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">Value</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">personValue</span><span class="p">(</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">optional</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">personValue</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>And then you can render a person:</p>
<div class="highlight"><pre><span></span><code><span class="n">Person</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="n">Logger</span><span class="o">&lt;</span><span class="n">PersonFieldBuilder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">personLogger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">basicLogger</span><span class="p">.</span><span class="na">withFieldBuilder</span><span class="p">(</span><span class="n">PersonFieldBuilder</span><span class="p">.</span><span class="na">instance</span><span class="p">);</span><span class="w"></span>
<span class="n">personLogger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Person {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">person</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">));</span><span class="w"></span>
</code></pre></div>
<h2 id="packages-and-modules">Packages and Modules<a class="headerlink" href="#packages-and-modules" title="Permanent link">&para;</a></h2>
<p>As you scale up structured logging, you'll eventually reach a point where you'll have mappings for classes that are used in different packages and in different modules.<br />
The best practice here is to create a field builder per package, and extend field builder logic by extending interfaces, and use a domain specific <code>Logging</code> interface to manage set up for the end users.</p>
<p>For example, you may have a <a href="https://en.wikipedia.org/wiki/Domain-driven_design">domain driven design</a> that defines classes entities and value objects in a domain layer, and these classes are then specialized and added to in subsequent modules.  Say you have a classic e-commerce application.  You might have several different modules:</p>
<ul>
<li>A <code>user</code> module containing customer information with address, payment, and authentication details.</li>
<li>An <code>order</code> module containing order's components like line items, promotions, and checkout logic, depends on <code>user</code></li>
</ul>
<p>You would naturally have domain classes organized by package in each module, i.e. the user module would have <code>com.mystore.user.User</code>, and an order would be <code>com.mystore.order.Order</code> and would have a <code>User</code> attached to it.</p>
<p>So, define a field builder per package, and add a <code>Logging</code> abstract class that exposes a logger with the appropriate field builder:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.mystore.user</span><span class="p">;</span><span class="w"></span>

<span class="c1">// field builder for the user package:</span><span class="w"></span>
<span class="kd">interface</span> <span class="nc">UserFieldBuilder</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">PresentationFieldBuilder</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">UserFieldBuilder</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserFieldBuilder</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">PresentationField</span><span class="w"> </span><span class="nf">user</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoggingBase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="o">&lt;</span><span class="n">UserFieldBuilder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UserFieldBuilder</span><span class="p">.</span><span class="na">instance</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SomeUserService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LoggingBase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">someMethod</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">trace</span><span class="p">(</span><span class="s">&quot;someMethod: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">user</span><span class="p">(</span><span class="n">user</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Because the <code>order</code> package depends on the <code>user</code> package, and an <code>Order</code> contains a <code>User</code>, you want to extend <code>OrderFieldBuilder</code> with <code>UserFieldBuilder</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.mystore.order</span><span class="p">;</span><span class="w"></span>

<span class="c1">// field builder for the order package</span><span class="w"></span>
<span class="kd">interface</span> <span class="nc">OrderFieldBuilder</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">UserFieldBuilder</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">OrderFieldBuilder</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderFieldBuilder</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">PresentationField</span><span class="w"> </span><span class="nf">orderId</span><span class="p">(</span><span class="n">OrderId</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">nullValue</span><span class="p">(</span><span class="s">&quot;order_id&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;order_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">PresentationField</span><span class="w"> </span><span class="nf">order</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">order</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">nullField</span><span class="p">(</span><span class="s">&quot;order&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">object</span><span class="p">(</span><span class="s">&quot;order&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">id</span><span class="p">),</span><span class="w"> </span><span class="n">user</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">user</span><span class="p">)</span><span class="w"> </span><span class="cm">/* ...more fields */</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoggingBase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Logger</span><span class="o">&lt;</span><span class="n">OrderFieldBuilder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getClass</span><span class="p">(),</span><span class="w"> </span><span class="n">OrderFieldBuilder</span><span class="p">.</span><span class="na">instance</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SomeOrderService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LoggingBase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">someMethod</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">trace</span><span class="p">(</span><span class="s">&quot;someMethod: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">order</span><span class="p">(</span><span class="n">order</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This way, you can have your loggers automatically "know" their domain classes and build on each other without exposing the underlying machinery to end users.</p>
<h2 id="exception-handling">Exception Handling<a class="headerlink" href="#exception-handling" title="Permanent link">&para;</a></h2>
<p>Avoid throwing exceptions in a field builder function.  Because a field builder function runs in a closure, if an exception is thrown it will be caught by Echopraxia's error handler which writes the exception to <code>System.err</code> by default.  </p>
<div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Message name {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodThatThrowsException</span><span class="p">();</span><span class="w"> </span><span class="c1">// BAD</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;some-value&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>
<p>Instead, only call field builder methods inside the closure and keep any construction logic outside:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodThatThrowsException</span><span class="p">();</span><span class="w"> </span><span class="c1">// GOOD</span><span class="w"></span>
<span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Message name {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;some-value&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>
<h2 id="structuredformat">StructuredFormat<a class="headerlink" href="#structuredformat" title="Permanent link">&para;</a></h2>
<p>Using the <code>withStructuredFormat</code> method with a field visitor will allow the JSON output to contain different fields when you want to provide extra type information that isn't relevant in text.</p>
<p>For example, imagine you want to render a <code>java.lang.Instant</code> in JSON as having an explicit <code>@type</code> of <code>http://www.w3.org/2001/XMLSchema#dateTime</code> alongside the value, but don't want to needlessly complicate your output.  Using <code>withStructuredFormat</code> with a class extending <code>SimpleFieldVisitor</code>, you can intercept and override field processing in JSON:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">InstantFieldBuilder</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">PresentationFieldBuilder</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">FieldVisitor</span><span class="w"> </span><span class="n">instantVisitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InstantFieldVisitor</span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">PresentationField</span><span class="w"> </span><span class="nf">instant</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">instant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">instant</span><span class="p">.</span><span class="na">toString</span><span class="p">()).</span><span class="na">withStructuredFormat</span><span class="p">(</span><span class="n">instantVisitor</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kd">class</span> <span class="nc">InstantFieldVisitor</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SimpleFieldVisitor</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nd">@Override</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="nf">visitString</span><span class="p">(</span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">Value</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stringValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">typedInstant</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">stringValue</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">PresentationField</span><span class="w"> </span><span class="nf">typedInstant</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Value</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">object</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">typedInstantValue</span><span class="p">(</span><span class="n">v</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">Value</span><span class="p">.</span><span class="na">ObjectValue</span><span class="w"> </span><span class="nf">typedInstantValue</span><span class="p">(</span><span class="n">Value</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="na">object</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">string</span><span class="p">(</span><span class="s">&quot;@type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://www.w3.org/2001/XMLSchema#dateTime&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">keyValue</span><span class="p">(</span><span class="s">&quot;@value&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Override</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">ArrayVisitor</span><span class="w"> </span><span class="nf">visitArray</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InstantArrayVisitor</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">class</span> <span class="nc">InstantArrayVisitor</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SimpleArrayVisitor</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nd">@Override</span><span class="w"></span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">visitStringElement</span><span class="p">(</span><span class="n">Value</span><span class="p">.</span><span class="na">StringValue</span><span class="w"> </span><span class="n">stringValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">elements</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">typedInstantValue</span><span class="p">(</span><span class="n">stringValue</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This field builder will render <code>fb.instant("startTime", Instant.ofEpochMillis(0))</code> as the following in text:</p>
<div class="highlight"><pre><span></span><code>startTime=1970-01-01T00:00:00Z
</code></pre></div>
<p>But will render JSON as:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;startTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;@type&quot;</span><span class="p">:</span><span class="s2">&quot;http://www.w3.org/2001/XMLSchema#dateTime&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;@value&quot;</span><span class="p">:</span><span class="s2">&quot;1970-01-01T00:00:00Z&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../basics/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Basics" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Basics
            </div>
          </div>
        </a>
      
      
        
        <a href="../context/" class="md-footer__link md-footer__link--next" aria-label="Next: Context" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Context
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://mastodon.xyz/web/@will_sargent" target="_blank" rel="noopener" title="mastodon.xyz" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>